<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="RatingMapper">
    
    <!-- 맛집별 평점 분포 조회 -->
    <select id="findRatingDistributionByRestaurantId" parameterType="int" resultType="RatingDistribution">
        SELECT 
            id,
            restaurant_id as restaurantId,
            rating_1 as rating1,
            rating_2 as rating2,
            rating_3 as rating3,
            rating_4 as rating4,
            rating_5 as rating5,
            created_at as createdAt,
            updated_at as updatedAt
        FROM rating_distributions 
        WHERE restaurant_id = #{restaurantId}
    </select>
    
    <!-- 맛집별 상세 평점 조회 -->
    <select id="findDetailedRatingsByRestaurantId" parameterType="int" resultType="DetailedRatings">
        SELECT 
            id,
            restaurant_id as restaurantId,
            taste,
            price,
            service,
            created_at as createdAt,
            updated_at as updatedAt
        FROM detailed_ratings 
        WHERE restaurant_id = #{restaurantId}
    </select>
    
    <!-- 평점 분포 추가 -->
    <insert id="insertRatingDistribution" parameterType="RatingDistribution" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO rating_distributions (
            restaurant_id,
            rating_1,
            rating_2,
            rating_3,
            rating_4,
            rating_5,
            created_at,
            updated_at
        ) VALUES (
            #{restaurantId},
            #{rating1},
            #{rating2},
            #{rating3},
            #{rating4},
            #{rating5},
            NOW(),
            NOW()
        )
    </insert>
    
    <!-- 상세 평점 추가 -->
    <insert id="insertDetailedRatings" parameterType="DetailedRatings" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO detailed_ratings (
            restaurant_id,
            taste,
            price,
            service,
            created_at,
            updated_at
        ) VALUES (
            #{restaurantId},
            #{taste},
            #{price},
            #{service},
            NOW(),
            NOW()
        )
    </insert>
    
</mapper>
