<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.meetlog.mapper.MaterialMapper">
  <resultMap id="MaterialMap" type="com.meetlog.dto.Material">
    <id property="id" column="id"/>
    <result property="companyId" column="company_id"/>
    <result property="name" column="name"/>
    <result property="unit" column="unit"/>
    <result property="unitPrice" column="unit_price"/>
    <result property="imgPath" column="img_path"/>
    <result property="step" column="step"/>
    <result property="activeYn" column="active_yn"/>
    <result property="deletedYn" column="deleted_yn"/>
  </resultMap>

  <select id="listMaterials" parameterType="map" resultMap="MaterialMap">
    SELECT * FROM material
    WHERE company_id=#{companyId} AND deleted_yn='N'
    ORDER BY name
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <insert id="insertMaterial" useGeneratedKeys="true" keyProperty="id" parameterType="com.meetlog.dto.Material">
    INSERT INTO material (company_id, name, unit, unit_price, img_path, step, active_yn, deleted_yn)
    VALUES (#{companyId}, #{name}, #{unit}, #{unitPrice}, #{imgPath}, #{step}, #{activeYn}, #{deletedYn})
  </insert>

  <update id="updateMaterial" parameterType="com.meetlog.dto.Material">
    UPDATE material SET
      name=#{name}, unit=#{unit}, unit_price=#{unitPrice}, img_path=#{imgPath},
      step=#{step}, active_yn=#{activeYn}, updated_at=NOW()
    WHERE id=#{id} AND company_id=#{companyId}
  </update>

  <update id="softDeleteMaterial" parameterType="map">
    UPDATE material SET deleted_yn='Y', updated_at=NOW()
    WHERE id=#{id} AND company_id=#{companyId}
  </update>
</mapper>
